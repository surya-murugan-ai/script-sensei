{
  "meta": {
    "project": "MedExtract AI",
    "date": "2025-10-20",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "MedExtract AI is a comprehensive full-stack platform designed to extract and analyze structured data from handwritten prescription images using advanced AI models including OpenAI GPT-4V, Anthropic Claude, and Google Gemini. It offers features for upload, processing, multi-model consensus, configuration management, and data export to facilitate accurate and efficient prescription data handling.",
  "core_goals": [
    "Enable users to upload and securely manage handwritten prescription images.",
    "Leverage multiple AI models in parallel to extract detailed prescription information with high accuracy.",
    "Provide configuration options for AI extraction prompts and model preferences to customize processing.",
    "Present extraction results in an editable format for review and correction by users.",
    "Maintain a processing queue that tracks prescription statuses through their lifecycle.",
    "Facilitate export of processed data in CSV and JSON formats for external use.",
    "Ensure robust validation, error handling, and secure file management throughout the system."
  ],
  "key_features": [
    "Drag-and-drop file upload interface with file type and size validation.",
    "Support for uploading multiple prescriptions simultaneously with progress feedback.",
    "Parallel processing of prescriptions using OpenAI GPT-4V, Anthropic Claude, and Google Gemini AI models.",
    "Configurable extraction prompts and AI model parameters to optimize data extraction quality.",
    "Management APIs for CRUD operations on prescriptions and extraction configurations.",
    "Real-time display and management of processing queue and prescription statuses.",
    "Editable extraction results component allowing users to review and update extracted data fields.",
    "Data export endpoints supporting CSV and JSON formats for prescription data.",
    "Backend image processing with Sharp and secure handling with Multer middleware.",
    "In-memory storage for initial deployment with planned database migration using PostgreSQL and Drizzle ORM."
  ],
  "user_flow_summary": [
    "User accesses the application and uploads prescription images via a drag-and-drop interface supporting multiple files.",
    "The system validates and optimizes the images before storing them with unique identifiers.",
    "Uploaded prescriptions enter a processing queue with visible status updates (queued, processing, completed, failed).",
    "The system sends each prescription in parallel to configured AI models (OpenAI, Claude, Gemini) for data extraction using user-configured prompts where applicable.",
    "Extraction results from each AI model are aggregated and presented for user review in an editable format.",
    "Users can update or correct the extracted prescription data as needed.",
    "Users manage extraction configurations to tweak AI model parameters and prompts through dedicated interfaces.",
    "Users export selected prescription data via API endpoints in CSV or JSON format for external reporting or integration.",
    "Administrators or users can retrieve, delete, or force delete prescriptions through management APIs."
  ],
  "validation_criteria": [
    "Uploaded files are validated for accepted MIME types and size before processing.",
    "Prescription images are optimized and uniquely identified upon upload.",
    "Prescriptions move through processing statuses correctly and in real-time.",
    "All configured AI models process the prescriptions in parallel and return extraction results.",
    "Extraction results are consistent with the predefined schema for patient, medication, investigations, and doctor details.",
    "Users can successfully update extraction results and changes are persisted.",
    "Data exports correctly reflect selected prescription IDs and formats (CSV/JSON) are valid and downloadable.",
    "API endpoints handle errors gracefully with clear messages and appropriate HTTP status codes.",
    "Configuration changes for AI models and prompts are stored and retrieved accurately.",
    "Frontend components display current statuses and data accurately and allow user interactions as designed."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "React",
      "Express.js",
      "PostgreSQL",
      "Docker",
      "Vite",
      "Tailwind CSS",
      "Radix UI",
      "React Query",
      "Drizzle ORM",
      "OpenAI API",
      "Anthropic Claude API",
      "Google Gemini API",
      "Sharp",
      "Multer",
      "Zod"
    ],
    "features": [
      {
        "name": "Health Check API",
        "description": "Health check endpoint for monitoring application status and Docker health checks",
        "files": [
          "server/routes.ts"
        ],
        "api_doc": {
          "paths": {
            "/api/health": {
              "get": {
                "summary": "Health Check",
                "description": "Returns application health status",
                "responses": {
                  "200": {
                    "description": "Application is healthy",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "object",
                          "properties": {
                            "status": {
                              "type": "string",
                              "example": "healthy"
                            },
                            "timestamp": {
                              "type": "string",
                              "format": "date-time"
                            },
                            "uptime": {
                              "type": "number"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Prescription Management API",
        "description": "CRUD operations for managing prescription records including upload, processing, and retrieval",
        "files": [
          "server/routes.ts",
          "server/storage.ts"
        ],
        "api_doc": {
          "paths": {
            "/api/prescriptions": {
              "get": {
                "summary": "Get All Prescriptions",
                "description": "Retrieve all prescription records",
                "responses": {
                  "200": {
                    "description": "List of prescriptions",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "processingStatus": {
                                "type": "string"
                              },
                              "createdAt": {
                                "type": "string",
                                "format": "date-time"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/api/prescriptions/upload": {
              "post": {
                "summary": "Upload Prescription Images",
                "description": "Upload multiple prescription images for processing",
                "requestBody": {
                  "content": {
                    "multipart/form-data": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "files": {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "format": "binary"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Images uploaded successfully",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "object",
                          "properties": {
                            "message": {
                              "type": "string"
                            },
                            "prescriptionIds": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/api/prescriptions/{id}": {
              "get": {
                "summary": "Get Prescription by ID",
                "description": "Retrieve a specific prescription by ID",
                "parameters": [
                  {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Prescription details",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "processingStatus": {
                              "type": "string"
                            },
                            "extractedData": {
                              "type": "object"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              "delete": {
                "summary": "Delete Prescription",
                "description": "Delete a prescription record",
                "parameters": [
                  {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  },
                  {
                    "name": "force",
                    "in": "query",
                    "required": false,
                    "schema": {
                      "type": "boolean"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Prescription deleted successfully"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "AI Processing API",
        "description": "AI-powered prescription data extraction using multiple AI models (OpenAI, Claude, Gemini)",
        "files": [
          "server/aiServices.ts",
          "server/routes.ts"
        ],
        "api_doc": {
          "paths": {
            "/api/prescriptions/{id}/process": {
              "post": {
                "summary": "Process Prescription with AI",
                "description": "Extract data from prescription image using AI models",
                "parameters": [
                  {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "requestBody": {
                  "content": {
                    "multipart/form-data": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "file": {
                            "type": "string",
                            "format": "binary"
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Processing completed",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "object",
                          "properties": {
                            "message": {
                              "type": "string"
                            },
                            "extractedData": {
                              "type": "object"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Extraction Results API",
        "description": "Manage and retrieve AI extraction results for prescription data",
        "files": [
          "server/routes.ts",
          "server/storage.ts"
        ],
        "api_doc": {
          "paths": {
            "/api/extraction-results": {
              "get": {
                "summary": "Get All Extraction Results",
                "description": "Retrieve all AI extraction results",
                "responses": {
                  "200": {
                    "description": "List of extraction results",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "model": {
                                "type": "string"
                              },
                              "extractedData": {
                                "type": "object"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Configuration Management API",
        "description": "Manage AI model configurations and extraction settings",
        "files": [
          "server/routes.ts",
          "server/storage.ts"
        ],
        "api_doc": {
          "paths": {
            "/api/configs": {
              "get": {
                "summary": "Get AI Configurations",
                "description": "Retrieve AI model configurations",
                "responses": {
                  "200": {
                    "description": "List of configurations",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "selectedModels": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              },
                              "isDefault": {
                                "type": "boolean"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              "post": {
                "summary": "Create AI Configuration",
                "description": "Create new AI model configuration",
                "requestBody": {
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "selectedModels": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "isDefault": {
                            "type": "boolean"
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "201": {
                    "description": "Configuration created successfully"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Data Export API",
        "description": "Export prescription data in CSV and JSON formats",
        "files": [
          "server/routes.ts"
        ],
        "api_doc": {
          "paths": {
            "/api/export/csv": {
              "get": {
                "summary": "Export Data as CSV",
                "description": "Export prescription data in CSV format",
                "parameters": [
                  {
                    "name": "prescriptionId",
                    "in": "query",
                    "required": false,
                    "schema": {
                      "type": "string"
                    }
                  },
                  {
                    "name": "prescriptionIds",
                    "in": "query",
                    "required": false,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "CSV file download",
                    "content": {
                      "text/csv": {
                        "schema": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            },
            "/api/export/json": {
              "get": {
                "summary": "Export Data as JSON",
                "description": "Export prescription data in JSON format",
                "parameters": [
                  {
                    "name": "prescriptionId",
                    "in": "query",
                    "required": false,
                    "schema": {
                      "type": "string"
                    }
                  },
                  {
                    "name": "prescriptionIds",
                    "in": "query",
                    "required": false,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "JSON data export",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "array",
                          "items": {
                            "type": "object"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}
