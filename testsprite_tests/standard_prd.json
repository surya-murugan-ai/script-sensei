{
  "meta": {
    "project": "MedExtract AI",
    "date": "2025-10-20",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "MedExtract AI is a comprehensive full-stack platform designed to extract and analyze structured data from handwritten prescription images using advanced AI models including OpenAI GPT-4V, Anthropic Claude, and Google Gemini. It offers features for upload, processing, multi-model consensus, configuration management, and data export to facilitate accurate and efficient prescription data handling.",
  "core_goals": [
    "Enable users to upload and securely manage handwritten prescription images.",
    "Leverage multiple AI models in parallel to extract detailed prescription information with high accuracy.",
    "Provide configuration options for AI extraction prompts and model preferences to customize processing.",
    "Present extraction results in an editable format for review and correction by users.",
    "Maintain a processing queue that tracks prescription statuses through their lifecycle.",
    "Facilitate export of processed data in CSV and JSON formats for external use.",
    "Ensure robust validation, error handling, and secure file management throughout the system."
  ],
  "key_features": [
    "Drag-and-drop file upload interface with file type and size validation.",
    "Support for uploading multiple prescriptions simultaneously with progress feedback.",
    "Parallel processing of prescriptions using OpenAI GPT-4V, Anthropic Claude, and Google Gemini AI models.",
    "Configurable extraction prompts and AI model parameters to optimize data extraction quality.",
    "Management APIs for CRUD operations on prescriptions and extraction configurations.",
    "Real-time display and management of processing queue and prescription statuses.",
    "Editable extraction results component allowing users to review and update extracted data fields.",
    "Data export endpoints supporting CSV and JSON formats for prescription data.",
    "Backend image processing with Sharp and secure handling with Multer middleware.",
    "In-memory storage for initial deployment with planned database migration using PostgreSQL and Drizzle ORM."
  ],
  "user_flow_summary": [
    "User accesses the application and uploads prescription images via a drag-and-drop interface supporting multiple files.",
    "The system validates and optimizes the images before storing them with unique identifiers.",
    "Uploaded prescriptions enter a processing queue with visible status updates (queued, processing, completed, failed).",
    "The system sends each prescription in parallel to configured AI models (OpenAI, Claude, Gemini) for data extraction using user-configured prompts where applicable.",
    "Extraction results from each AI model are aggregated and presented for user review in an editable format.",
    "Users can update or correct the extracted prescription data as needed.",
    "Users manage extraction configurations to tweak AI model parameters and prompts through dedicated interfaces.",
    "Users export selected prescription data via API endpoints in CSV or JSON format for external reporting or integration.",
    "Administrators or users can retrieve, delete, or force delete prescriptions through management APIs."
  ],
  "validation_criteria": [
    "Uploaded files are validated for accepted MIME types and size before processing.",
    "Prescription images are optimized and uniquely identified upon upload.",
    "Prescriptions move through processing statuses correctly and in real-time.",
    "All configured AI models process the prescriptions in parallel and return extraction results.",
    "Extraction results are consistent with the predefined schema for patient, medication, investigations, and doctor details.",
    "Users can successfully update extraction results and changes are persisted.",
    "Data exports correctly reflect selected prescription IDs and formats (CSV/JSON) are valid and downloadable.",
    "API endpoints handle errors gracefully with clear messages and appropriate HTTP status codes.",
    "Configuration changes for AI models and prompts are stored and retrieved accurately.",
    "Frontend components display current statuses and data accurately and allow user interactions as designed."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Node.js",
      "Express.js",
      "PostgreSQL",
      "Drizzle ORM",
      "React",
      "Vite",
      "Docker",
      "Sharp",
      "Multer",
      "OpenAI API",
      "Anthropic Claude API",
      "Google Gemini API"
    ],
    "features": [
      {
        "name": "Health Check API",
        "description": "Returns application health status and uptime information",
        "files": [
          "server/routes.ts"
        ],
        "api_doc": {
          "get": {
            "/api/health": {
              "summary": "Health check endpoint",
              "responses": {
                "200": {
                  "description": "Application is healthy",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "status": {
                            "type": "string"
                          },
                          "timestamp": {
                            "type": "string"
                          },
                          "uptime": {
                            "type": "number"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Prescription Management API",
        "description": "Upload, retrieve, and manage prescription images with AI processing",
        "files": [
          "server/routes.ts",
          "server/storage.ts",
          "shared/schema.ts"
        ],
        "api_doc": {
          "get": {
            "/api/prescriptions": {
              "summary": "Get all prescriptions",
              "responses": {
                "200": {
                  "description": "List of prescriptions",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "fileName": {
                              "type": "string"
                            },
                            "fileSize": {
                              "type": "string"
                            },
                            "uploadedAt": {
                              "type": "string"
                            },
                            "createdAt": {
                              "type": "string"
                            },
                            "processingStatus": {
                              "type": "string"
                            },
                            "extractedData": {
                              "type": "object"
                            },
                            "imageData": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "/api/prescriptions/{id}": {
              "summary": "Get prescription by ID",
              "parameters": [
                {
                  "name": "id",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "Prescription details with extraction results"
                },
                "404": {
                  "description": "Prescription not found"
                }
              }
            }
          },
          "post": {
            "/api/prescriptions/upload": {
              "summary": "Upload prescription files",
              "requestBody": {
                "content": {
                  "multipart/form-data": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "files": {
                          "type": "array",
                          "items": {
                            "type": "string",
                            "format": "binary"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Files uploaded successfully",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "prescriptions": {
                            "type": "array"
                          },
                          "message": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                },
                "400": {
                  "description": "No files uploaded or validation error"
                },
                "500": {
                  "description": "Upload failed"
                }
              }
            }
          },
          "delete": {
            "/api/prescriptions/{id}": {
              "summary": "Delete prescription",
              "parameters": [
                {
                  "name": "id",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                },
                {
                  "name": "force",
                  "in": "query",
                  "schema": {
                    "type": "boolean"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "Prescription deleted successfully"
                },
                "400": {
                  "description": "Force parameter required for completed prescriptions"
                },
                "404": {
                  "description": "Prescription not found"
                }
              }
            }
          }
        }
      },
      {
        "name": "AI Processing API",
        "description": "Process prescriptions with AI models for data extraction",
        "files": [
          "server/routes.ts",
          "server/aiServices.ts",
          "server/storage.ts"
        ],
        "api_doc": {
          "post": {
            "/api/prescriptions/{id}/process": {
              "summary": "Process prescription with AI models",
              "parameters": [
                {
                  "name": "id",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "selectedModels": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "customPrompts": {
                          "type": "object"
                        }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Processing completed successfully"
                },
                "400": {
                  "description": "No image data available"
                },
                "404": {
                  "description": "Prescription not found"
                },
                "500": {
                  "description": "Processing failed"
                }
              }
            },
            "/api/prescriptions/{id}/process-existing": {
              "summary": "Process existing prescription without file upload",
              "parameters": [
                {
                  "name": "id",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "Processing completed successfully"
                },
                "400": {
                  "description": "No image data available"
                },
                "404": {
                  "description": "Prescription not found"
                }
              }
            }
          },
          "get": {
            "/api/extraction-results": {
              "summary": "Get all extraction results",
              "responses": {
                "200": {
                  "description": "List of extraction results",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "prescriptionId": {
                              "type": "string"
                            },
                            "modelName": {
                              "type": "string"
                            },
                            "fieldName": {
                              "type": "string"
                            },
                            "extractedValue": {
                              "type": "string"
                            },
                            "confidence": {
                              "type": "number"
                            },
                            "processingTime": {
                              "type": "number"
                            },
                            "createdAt": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Configuration Management API",
        "description": "Manage AI extraction configurations",
        "files": [
          "server/routes.ts",
          "server/storage.ts",
          "shared/schema.ts"
        ],
        "api_doc": {
          "get": {
            "/api/configs": {
              "summary": "Get all extraction configurations",
              "responses": {
                "200": {
                  "description": "List of configurations",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "selectedModels": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            },
                            "selectedFields": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            },
                            "customPrompts": {
                              "type": "object"
                            },
                            "isDefault": {
                              "type": "boolean"
                            },
                            "createdAt": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "post": {
            "/api/configs": {
              "summary": "Create new extraction configuration",
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "required": [
                        "name",
                        "selectedModels",
                        "selectedFields"
                      ],
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "selectedModels": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "selectedFields": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "customPrompts": {
                          "type": "object"
                        },
                        "isDefault": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                }
              },
              "responses": {
                "201": {
                  "description": "Configuration created successfully"
                },
                "400": {
                  "description": "Invalid configuration data"
                }
              }
            }
          },
          "put": {
            "/api/configs/{id}": {
              "summary": "Update extraction configuration",
              "parameters": [
                {
                  "name": "id",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "Configuration updated successfully"
                },
                "404": {
                  "description": "Configuration not found"
                }
              }
            }
          }
        }
      },
      {
        "name": "Data Export API",
        "description": "Export prescription data in CSV and JSON formats",
        "files": [
          "server/routes.ts",
          "server/storage.ts"
        ],
        "api_doc": {
          "get": {
            "/api/export/csv": {
              "summary": "Export prescriptions as CSV",
              "parameters": [
                {
                  "name": "prescriptionId",
                  "in": "query",
                  "schema": {
                    "type": "string"
                  }
                },
                {
                  "name": "prescriptionIds",
                  "in": "query",
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "CSV file download",
                  "content": {
                    "text/csv": {
                      "schema": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            },
            "/api/export/json": {
              "summary": "Export prescriptions as JSON",
              "parameters": [
                {
                  "name": "prescriptionId",
                  "in": "query",
                  "schema": {
                    "type": "string"
                  }
                },
                {
                  "name": "prescriptionIds",
                  "in": "query",
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "JSON data export",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "prescriptions": {
                            "type": "array"
                          },
                          "extractionResults": {
                            "type": "array"
                          },
                          "exportedAt": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}
